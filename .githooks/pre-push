#!/bin/bash
# pre-push hook: prevent pushing if forbidden folders exist or staged .md files
# Place in .git/hooks/pre-push and make executable

# =====================================================================
# CONFIGURATION
# =====================================================================

FORBIDDEN_FOLDERS=(
  "public"
  "dist"
  "build"
)

# =====================================================================
# CHECK FOR FORBIDDEN FOLDERS
# =====================================================================

echo "=============================================================="
echo "PRE-PUSH CHECK: Forbidden folders and staged .md files"
echo "--------------------------------------------------------------"

FOUND=0

for folder in "${FORBIDDEN_FOLDERS[@]}"; do
    if [ -d "$folder" ]; then
        echo "ERROR: Forbidden folder exists: $folder"
        FOUND=1
    fi
done

# =====================================================================
# CHECK FOR STAGED .MD FILES
# =====================================================================

STAGED_MD=$(git diff --cached --name-only | grep -E '\.md$')
if [ -n "$STAGED_MD" ]; then
    echo "ERROR: Staged Markdown files detected:"
    echo "$STAGED_MD" | sed 's/^/    /'
    FOUND=1
fi

echo "--------------------------------------------------------------"

if [ $FOUND -eq 1 ]; then
    echo "Push aborted: Fix the issues above before pushing."
    echo "=============================================================="
    exit 1
fi

echo "No forbidden folders or staged .md files found. Push allowed."
echo "=============================================================="
exit 0
